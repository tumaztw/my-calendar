<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼µè€å¸«æ•™å­¸é€²åº¦çœ‹æ¿</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6fa5;   /* è—è‰² (ä¸€èˆ¬/æœªä¾†) */
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --text-main: #333;
            --text-sub: #666;
            
            --accent-color: #ff9800;    /* æ©˜è‰² (ä¸Šèª²ä¸­) */
            --pending-color: #9c27b0;   /* ç´«è‰² (å·²ä¸‹èª²æœªæ›´æ–° - å¼·çƒˆæé†’) */
            --success-color: #28a745;   /* ç¶ è‰² (å·²å®Œæˆ) */
            --new-badge-color: #ff5722; /* äº®æ©˜ç´… (æ–°é€²åº¦æ¨™ç±¤) */
        }
        body {
            font-family: "Microsoft JhengHei", "Segoe UI", sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-main);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .date-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 15px;
            user-select: none;
        }
        .nav-btn {
            background-color: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .nav-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }
        .nav-btn:active {
            transform: scale(0.95);
        }
        .date-display {
            font-size: 1.4rem;
            color: var(--primary-color);
            font-weight: bold;
            min-width: 200px;
            text-align: center;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* --- å¡ç‰‡åŸºç¤æ¨£å¼ --- */
        .class-card {
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            overflow: hidden;
            border-left: 6px solid var(--primary-color);
            transition: transform 0.2s, border-color 0.3s;
        }
        .class-card:hover {
            transform: translateY(-2px);
        }
        
        /* ğŸ§¡ ä¸Šèª²ä¸­ç‰¹æ•ˆ (æ©˜è‰²) */
        .class-card.active-now {
            border-left-color: var(--accent-color);
            box-shadow: 0 6px 15px rgba(255, 152, 0, 0.25);
        }

        /* ğŸ’œ å·²ä¸‹èª²æœªæ›´æ–°ç‰¹æ•ˆ (ç´«è‰²) */
        .class-card.status-pending {
            border-left-color: var(--pending-color);
            box-shadow: 0 6px 15px rgba(156, 39, 176, 0.25);
        }

        .card-header {
            background-color: #eef2f7;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap; 
        }

        .period-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 24px;       
            border-radius: 30px;      
            font-size: 1.3rem;        
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15); 
            display: inline-flex;
            align-items: center;
            flex-shrink: 0;
        }

        /* --- å‹•ç•«ç‰¹æ•ˆå€ --- */
        
        /* ä¸Šä¸‹è·³å‹• */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        /* å‘¼å¸ç‡ˆ (æ©˜è‰²) */
        @keyframes pulse-orange {
            0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 87, 34, 0.7); }
            70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(255, 87, 34, 0); }
            100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(255, 87, 34, 0); }
        }
        /* å‘¼å¸ç‡ˆ (ç´«è‰² - å¼·çƒˆæé†’) */
        @keyframes pulse-purple {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
            100% { opacity: 1; transform: scale(1); }
        }

        /* ä¸Šèª²ä¸­æ¨™ç¤º */
        .live-indicator-group {
            display: inline-flex;
            align-items: center;
            animation: bounce 1.5s infinite ease-in-out;
        }
        .live-text {
            color: var(--accent-color);
            font-weight: bold;
            font-size: 1rem;
            white-space: nowrap;
        }

        /* ä¸‹èª²è£œå¡«æ¨™ç¤º */
        .pending-text {
            color: var(--pending-color);
            font-weight: bold;
            font-size: 1rem;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            animation: pulse-purple 2s infinite;
        }

        .class-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .card-body {
            padding: 20px;
        }
        
        .last-record {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            border: 1px solid #ffe0b2;
        }
        .last-record h4 {
            margin: 0 0 12px 0;
            color: var(--accent-color);
            font-size: 1rem;
            display: flex;
            align-items: center;
            border-bottom: 1px dashed #ffcc80;
            padding-bottom: 8px;
        }
        
        /* NEW æ¨™ç±¤ */
        .new-flash {
            display: inline-block;
            background-color: var(--new-badge-color);
            color: white;
            font-size: 0.8em;
            padding: 2px 10px;
            border-radius: 12px;
            margin-left: 10px;
            vertical-align: middle;
            font-weight: bold;
            animation: pulse-orange 2s infinite;
        }

        .record-item {
            margin-bottom: 8px;
            line-height: 1.6;
            display: flex;
        }
        .record-label {
            font-weight: bold;
            color: var(--text-sub);
            min-width: 50px;
            flex-shrink: 0;
        }
        .record-content {
            word-break: break-word;
        }
        
        /* --- æŒ‰éˆ•æ¨£å¼ --- */
        
        /* é è¨­ (è—è‰²) */
        .btn-add {
            display: block;
            width: 100%;
            text-align: center;
            background-color: var(--primary-color);
            color: white;
            padding: 14px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.05rem;
            transition: background 0.3s, transform 0.2s;
            border: none;
            cursor: pointer;
        }
        .btn-add:hover {
            background-color: #36527a;
        }
        
        /* ä¸Šèª²ä¸­ (æ©˜è‰²) */
        .active-now .btn-add {
             background-color: var(--accent-color);
        }
        .active-now .btn-add:hover {
             background-color: #bf360c;
        }

        /* ğŸ’œ å·²ä¸‹èª²æœªå¡«å¯« (ç´«è‰²) */
        .btn-add.pending-btn {
            background-color: var(--pending-color) !important;
            animation: pulse-purple 2s infinite; /* æŒ‰éˆ•ä¹Ÿæœƒå‘¼å¸ */
        }
        .btn-add.pending-btn:hover {
            background-color: #7b1fa2 !important;
        }

        /* ğŸ’š å·²æ›´æ–° (ç¶ è‰² - æœ€é«˜å„ªå…ˆæ¬Š) */
        .btn-add.updated {
            background-color: var(--success-color) !important;
            cursor: default;
            box-shadow: none;
            animation: none !important; /* ç§»é™¤æ‰€æœ‰å‹•ç•« */
        }
        .btn-add.updated:hover {
            transform: none;
            background-color: var(--success-color) !important;
        }

        .loading, .no-class {
            text-align: center;
            padding: 40px;
            color: var(--text-sub);
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        /* é–±è®€æŒ‡å°èª²çš„ç‰¹æ®Šé¡è‰² */
        .type-reading {
            border-left-color: #2e7d32;
        }
        .type-reading .period-badge {
            background-color: #2e7d32;
        }
        .type-reading .btn-add {
            background-color: #2e7d32;
        }
        .type-reading .btn-add:hover {
            background-color: #1b5e20;
        }

        /* é‡æ–°æ•´ç†æŒ‰éˆ• */
        .fab-refresh {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, background-color 0.3s;
            z-index: 9999;
        }
        .fab-refresh:hover {
            background-color: #36527a;
            transform: scale(1.1);
        }
        .fab-refresh:active {
            transform: scale(0.9);
        }
        .spinning {
            animation: spin 0.8s linear infinite;
            pointer-events: none;
            opacity: 0.8;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .class-title {
                align-self: flex-end;
                font-size: 1.1rem;
            }
            .fab-refresh {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>å¼µè€å¸«æ•™å­¸é€²åº¦çœ‹æ¿</h1>
    
    <div class="date-controls">
        <button class="nav-btn" onclick="changeDate(-1)">â—€</button>
        <div class="date-display" id="currentDateDisplay"></div>
        <button class="nav-btn" onclick="changeDate(1)">â–¶</button>
    </div>
</div>

<div class="container" id="scheduleContainer">
    <div class="loading">
        <p>â³ æ­£åœ¨è¼‰å…¥èª²è¡¨èˆ‡é›²ç«¯é€²åº¦...</p>
    </div>
</div>

<button class="fab-refresh" onclick="reloadData()" title="æ›´æ–°è³‡æ–™">
    â†»
</button>

<script>
    // ==========================================
    // â˜… è¨­å®šå€
    // ==========================================
    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSlivRAYD4jjOxvWWQ71eRKXfXG1pBr8oqr1k2d4h_Gq8Bt6evj_x-XQzlTV_DzhK9k8W1XEbqA2ljD/pub?output=csv';
    const formBaseUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSfgyKNluqNR1uo1kM89Jh4wp6yHs9Quisz_9OprFS9AcialXQ/viewform?usp=pp_url';
    
    const entryIds = {
        date: 'entry.1279670059',
        period: 'entry.1620291828'
    };

    const periodTimes = {
        1: { start: '08:15', end: '09:05' },
        2: { start: '09:15', end: '10:00' },
        3: { start: '10:10', end: '10:55' },
        4: { start: '11:05', end: '11:50' },
        5: { start: '13:30', end: '14:15' },
        6: { start: '14:25', end: '15:10' },
        7: { start: '15:20', end: '16:05' },
        8: { start: '16:15', end: '17:00' } 
    };

    const timetable = {
        1: [ // æ˜ŸæœŸä¸€
            { period: 1, class: '109', subject: 'åœ‹èªæ–‡' },
            { period: 2, class: '117', subject: 'åœ‹èªæ–‡' },
            { period: 4, class: '116', subject: 'åœ‹èªæ–‡' }
        ],
        2: [ // æ˜ŸæœŸäºŒ
            { period: 2, class: '116', subject: 'åœ‹èªæ–‡' },
            { period: 3, class: '109', subject: 'åœ‹èªæ–‡' },
            { period: 5, class: '117', subject: 'åœ‹èªæ–‡' },
            { period: 7, class: '116', subject: 'é–±è®€æŒ‡å°' }
        ],
        3: [ // æ˜ŸæœŸä¸‰
            { period: 2, class: '109', subject: 'åœ‹èªæ–‡' },
            { period: 3, class: '116', subject: 'åœ‹èªæ–‡' },
            { period: 7, class: '117', subject: 'åœ‹èªæ–‡' }
        ],
        4: [ // æ˜ŸæœŸå››
            { period: 1, class: '109', subject: 'åœ‹èªæ–‡' },
            { period: 3, class: '117', subject: 'åœ‹èªæ–‡' },
            { period: 4, class: '116', subject: 'åœ‹èªæ–‡' },
            { period: 6, class: '109', subject: 'é–±è®€æŒ‡å°' }
        ],
        5: [ // æ˜ŸæœŸäº”
            { period: 2, class: '116', subject: 'åœ‹èªæ–‡' },
            { period: 5, class: '117', subject: 'åœ‹èªæ–‡' },
            { period: 7, class: '109', subject: 'åœ‹èªæ–‡' }
        ]
    };

    // ==========================================
    // â˜… ç¨‹å¼é‚è¼¯å€
    // ==========================================

    let g_currentDate = new Date();
    let g_csvData = []; 
    let g_classRecords = {}; 

    document.addEventListener('DOMContentLoaded', () => {
        fetchData();
    });

    function changeDate(days) {
        g_currentDate.setDate(g_currentDate.getDate() + days);
        renderSchedule();
    }

    function reloadData() {
        const btn = document.querySelector('.fab-refresh');
        btn.classList.add('spinning');
        fetchData(function() {
            setTimeout(() => {
                btn.classList.remove('spinning');
            }, 600);
        });
    }

    function fetchData(callback) {
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            complete: function(results) {
                g_csvData = results.data;
                processData();
                renderSchedule();
                if (callback) callback();
            },
            error: function(err) {
                console.error("Error:", err);
                document.getElementById('scheduleContainer').innerHTML = '<div class="no-class">ç„¡æ³•è®€å–è³‡æ–™ã€‚</div>';
                if (callback) callback();
            }
        });
    }

    function getCourseObjByDateAndPeriod(dateStr, period) {
        const dateObj = new Date(dateStr);
        if (isNaN(dateObj)) return null;
        
        const dayOfWeek = dateObj.getDay();
        if (!timetable[dayOfWeek]) return null;
        
        const course = timetable[dayOfWeek].find(c => c.period == period);
        return course ? course : null;
    }

    function processData() {
        g_classRecords = {}; 
        g_csvData.forEach(row => {
            const date = row['æ—¥æœŸ']; 
            const period = row['ç¯€æ¬¡']; 
            
            if (date && period) {
                const courseObj = getCourseObjByDateAndPeriod(date, period);
                if (courseObj) {
                    const uniqueKey = `${courseObj.class}_${courseObj.subject}`;
                    if (!g_classRecords[uniqueKey] || date > g_classRecords[uniqueKey]['æ—¥æœŸ']) {
                        g_classRecords[uniqueKey] = row;
                    }
                }
            }
        });
    }

    // åˆ¤æ–·æ˜¯å¦ç‚ºã€Œç¾åœ¨æ­£åœ¨ä¸Šèª²ã€
    function checkIsCurrentPeriod(period) {
        const now = new Date();
        const isToday = g_currentDate.toDateString() === now.toDateString();
        if (!isToday) return false;

        if (!periodTimes[period]) return false;

        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        const [startH, startM] = periodTimes[period].start.split(':').map(Number);
        const startMinutes = startH * 60 + startM;
        const [endH, endM] = periodTimes[period].end.split(':').map(Number);
        const endMinutes = endH * 60 + endM;

        return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
    }

    // åˆ¤æ–·æ˜¯å¦ã€Œå·²ç¶“ä¸‹èª²ã€(éå»å¼)
    function checkIsPastPeriod(period) {
        const now = new Date();
        const isToday = g_currentDate.toDateString() === now.toDateString();
        if (!isToday) return false; // å¦‚æœä¸æ˜¯ä»Šå¤©ï¼Œå…ˆç°¡å–®å›å‚³ false (æˆ–ä¾éœ€æ±‚èª¿æ•´)

        if (!periodTimes[period]) return false;

        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        const [endH, endM] = periodTimes[period].end.split(':').map(Number);
        const endMinutes = endH * 60 + endM;

        // å¦‚æœç¾åœ¨æ™‚é–“ > çµæŸæ™‚é–“ï¼Œä»£è¡¨é€™ç¯€èª²å·²ç¶“çµæŸ
        return currentMinutes > endMinutes;
    }

    function markAsUpdated(uniqueId, btnElement) {
        localStorage.setItem(uniqueId, 'true');
        // è®Šç¶ è‰² (ç§»é™¤å…¶ä»–ç‹€æ…‹)
        btnElement.classList.remove('pending-btn');
        btnElement.classList.add('updated');
        btnElement.innerText = 'âœ… å·²æ›´æ–°ç•¶å¤©æ–°é€²åº¦';
        
        // å¦‚æœå¡ç‰‡æœ‰ pending ç‹€æ…‹ï¼Œä¹Ÿè¦ç§»é™¤ (é€é DOM éæ­·)
        const card = btnElement.closest('.class-card');
        if (card) {
            card.classList.remove('status-pending');
            // ç§»é™¤æ¨™é ­çš„æé†’æ–‡å­—
            const pendingText = card.querySelector('.pending-text');
            if (pendingText) pendingText.remove();
        }
    }

    function isSameDate(dateStr1, dateStr2) {
        const d1 = new Date(dateStr1);
        const d2 = new Date(dateStr2);
        return d1.getFullYear() === d2.getFullYear() &&
               d1.getMonth() === d2.getMonth() &&
               d1.getDate() === d2.getDate();
    }

    function renderSchedule() {
        const container = document.getElementById('scheduleContainer');
        const dateDisplay = document.getElementById('currentDateDisplay');
        
        const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
        dateDisplay.textContent = g_currentDate.toLocaleDateString('zh-TW', options);

        container.innerHTML = '';

        const dayOfWeek = g_currentDate.getDay();
        const y = g_currentDate.getFullYear();
        const m = String(g_currentDate.getMonth() + 1).padStart(2, '0');
        const d = String(g_currentDate.getDate()).padStart(2, '0');
        const dateStr = `${y}-${m}-${d}`; 

        if (!timetable[dayOfWeek]) {
            container.innerHTML = '<div class="no-class">â˜• ä»Šå¤©æ²’æœ‰æ’å®šçš„èª²ç¨‹ã€‚</div>';
            return;
        }

        const todaysClasses = timetable[dayOfWeek];
        const sortedClasses = [...todaysClasses].sort((a, b) => a.period - b.period);

        sortedClasses.forEach(course => {
            const uniqueKey = `${course.class}_${course.subject}`;
            const lastRecord = g_classRecords[uniqueKey];
            const formLink = `${formBaseUrl}&${entryIds.date}=${dateStr}&${entryIds.period}=${course.period}`;

            // ç‹€æ…‹æª¢æŸ¥
            const isLive = checkIsCurrentPeriod(course.period); // ç¾åœ¨æ˜¯å¦ä¸Šèª²ä¸­
            const isPast = checkIsPastPeriod(course.period);    // æ˜¯å¦å·²ç¶“ä¸‹èª²
            
            // æ˜¯å¦å·²æ›´æ–° (æœ¬åœ°æˆ–é ç«¯)
            const storageId = `record_${dateStr}_${course.class}_${course.period}`;
            const localUpdated = localStorage.getItem(storageId) === 'true';
            
            let serverUpdated = false;
            let recordHtml = '';

            if (lastRecord) {
                const isTodayRecord = isSameDate(lastRecord['æ—¥æœŸ'], dateStr);
                if (isTodayRecord) serverUpdated = true;

                let headerTitle = '';
                if (isTodayRecord) {
                    headerTitle = 'ğŸ“… æœ¬æ—¥æ–°é€²åº¦ <span class="new-flash">âœ¨ NEW</span>';
                } else {
                    const recordDateObj = new Date(lastRecord['æ—¥æœŸ']);
                    const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
                    const weekStr = days[recordDateObj.getDay()]; 
                    const shortDate = `${recordDateObj.getMonth() + 1}/${recordDateObj.getDate()}`;
                    headerTitle = `ğŸ“… ä¸Šæ¬¡é€²åº¦ (${shortDate} ${weekStr} - ç¬¬ ${lastRecord['ç¯€æ¬¡']} ç¯€)`;
                }

                recordHtml = `
                    <div class="last-record">
                        <h4>${headerTitle}</h4>
                        <div class="record-item">
                            <span class="record-label">é€²åº¦ï¼š</span>
                            <span class="record-content">${lastRecord['æ•™å­¸é€²åº¦'] || 'ç„¡'}</span>
                        </div>
                        <div class="record-item">
                            <span class="record-label">ä½œæ¥­ï¼š</span>
                            <span class="record-content">${lastRecord['ä½œæ¥­å…§å®¹'] || 'ç„¡'}</span>
                        </div>
                        <div class="record-item">
                            <span class="record-label">æé†’ï¼š</span>
                            <span class="record-content">${lastRecord['èª²å ‚æé†’'] || 'ç„¡'}</span>
                        </div>
                        ${lastRecord['å¹³æ™‚æ¸¬é©—'] ? `
                        <div class="record-item">
                            <span class="record-label">æ¸¬é©—ï¼š</span>
                            <span class="record-content">${lastRecord['å¹³æ™‚æ¸¬é©—']}</span>
                        </div>` : ''}
                    </div>
                `;
            } else {
                recordHtml = `
                    <div class="last-record" style="background-color: #f5f5f5; border:none; color: #888;">
                        å°šç„¡æ­¤èª²ç¨‹ (${course.class}${course.subject}) çš„éå¾€ç´€éŒ„
                    </div>
                `;
            }

            const isUpdated = localUpdated || serverUpdated;

            // â˜…â˜…â˜… æ±ºå®šå¡ç‰‡èˆ‡æŒ‰éˆ•çš„ç‹€æ…‹ â˜…â˜…â˜…
            // å„ªå…ˆé †åºï¼šå·²æ›´æ–°(ç¶ ) > ä¸Šèª²ä¸­(æ©˜) > å·²ä¸‹èª²æœªæ›´æ–°(ç´«) > æœªä¾†(è—)
            
            let activeClass = '';
            let headerStatusHtml = ''; // æ¨™é¡Œæ—çš„å°å­—
            let btnClass = '';
            let btnText = 'âœï¸ å¡«å¯«é€²åº¦';

            if (isUpdated) {
                // 1. å·²æ›´æ–° (ç¶ è‰²)
                btnClass = 'updated';
                btnText = 'âœ… å·²æ›´æ–°ç•¶å¤©æ–°é€²åº¦';
            } else if (isLive) {
                // 2. ä¸Šèª²ä¸­ (æ©˜è‰²)
                activeClass = 'active-now';
                headerStatusHtml = `<div class="live-indicator-group"><span class="live-text">âœ¨ ä¸Šèª²ä¸­</span></div>`;
                btnText = 'ğŸš€ ç«‹å³å¡«å¯«é€²åº¦';
            } else if (isPast) {
                // 3. å·²ä¸‹èª²ä½†æœªæ›´æ–° (ç´«è‰²æé†’)
                activeClass = 'status-pending';
                headerStatusHtml = `<div class="pending-text">ğŸ”” å·²ä¸‹èª²ï¼Œè«‹æ›´æ–°</div>`;
                btnClass = 'pending-btn';
                btnText = 'ğŸ”” å·²å®Œæˆèª²ç¨‹ï¼Œæ›´æ–°æ•™å­¸é€²åº¦';
            }

            const card = document.createElement('div');
            card.className = `class-card ${course.subject === 'é–±è®€æŒ‡å°' ? 'type-reading' : ''} ${activeClass}`;
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="header-left">
                        <span class="period-badge">ç¬¬ ${course.period} ç¯€</span>
                        ${headerStatusHtml}
                    </div>
                    <span class="class-title">${course.class} ç­ - ${course.subject}</span>
                </div>
                <div class="card-body">
                    ${recordHtml}
                    <a href="${formLink}" target="_blank" 
                       class="btn-add ${btnClass}"
                       onclick="markAsUpdated('${storageId}', this)">
                        ${btnText}
                    </a>
                </div>
            `;
            container.appendChild(card);
        });
    }
</script>

</body>
</html>

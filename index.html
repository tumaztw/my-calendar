<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼µè€å¸«æ•™å­¸æ—¥èªŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen pb-12">
    <div class="max-w-md mx-auto bg-white min-h-screen shadow-2xl flex flex-col">
        <div class="bg-indigo-700 p-6 text-white text-center shadow-lg">
            <h1 class="text-xl font-bold tracking-tight">å¼µå…è’¼è€å¸« æ•™å­¸çœ‹æ¿</h1>
            <p class="text-[10px] opacity-80 mt-1 uppercase">Fushan Junior High School â€¢ 114-1</p>
        </div>

        <div class="flex items-center justify-between p-4 bg-white/90 backdrop-blur sticky top-0 border-b z-50 shadow-sm">
            <button onclick="changeWeek(-1)" class="w-12 h-10 flex items-center justify-center bg-slate-100 rounded-xl hover:bg-indigo-100 transition-all text-slate-600">â—€</button>
            <div id="week-label" class="font-black text-indigo-900 text-lg">è®€å–ä¸­...</div>
            <button onclick="changeWeek(1)" class="w-12 h-10 flex items-center justify-center bg-slate-100 rounded-xl hover:bg-indigo-100 transition-all text-slate-600">â–¶</button>
        </div>

        <div id="main-list" class="flex-1 p-4 space-y-6">
            <div class="text-center py-20 text-slate-300 italic animate-pulse">æ­£åœ¨å¾è©¦ç®—è¡¨åŒæ­¥è³‡æ–™...</div>
        </div>

        <div class="px-6 py-4 bg-slate-50 text-[10px] text-gray-400 border-t text-center">
            ğŸ“ æ¥ æ¢“åœŸåº« â‡„ å·¦ç‡Ÿé‡ä¿¡è·¯ â€¢ è‡ªå‹•åŒæ­¥ç³»çµ±å·²å°±ç·’
        </div>
    </div>

    <script>
        // --- è¨­å®šå€ ---
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSlivRAYD4jjOxvWWQ71eRKXfXG1pBr8oqr1k2d4h_Gq8Bt6evj_x-XQzlTV_DzhK9k8W1XEbqA2ljD/pub?output=csv";
        const formBaseUrl = "https://docs.google.com/forms/d/e/1FAIpQLSfgyKNluqNR1uo1kM89Jh4wp6yHs9Quisz_9OprFS9AcialXQ/viewform";
        const dateId = "entry.1279670059"; 
        const periodId = "entry.1620291828";

        const timeSlots = { 1: "08:20", 2: "09:15", 3: "10:10", 4: "11:05", 5: "13:15", 6: "14:10", 7: "15:15" };
        const baseSchedule = {
            1: { 1: "109 åœ‹èª", 2: "117 åœ‹èª", 4: "116 åœ‹èª" },
            2: { 2: "116 åœ‹èª", 3: "109 åœ‹èª", 5: "117 åœ‹èª", 7: "116 é–±è®€" },
            3: { 2: "109 åœ‹èª", 3: "116 åœ‹èª", 7: "117 åœ‹èª" },
            4: { 1: "109 åœ‹èª", 3: "117 åœ‹èª", 4: "116 åœ‹èª", 6: "109 é–±è®€" },
            5: { 2: "116 åœ‹èª", 5: "117 åœ‹èª", 7: "109 åœ‹èª" }
        };

        let notesData = []; 
        let anchor = new Date();

        async function fetchNotes() {
            try {
                const res = await fetch(csvUrl);
                const text = await res.text();
                const rows = text.split('\n').slice(1);
                notesData = rows.map(r => {
                    // è™•ç†å…§å®¹ä¸­çš„é€—è™Ÿ
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return { 
                        d: c[1]?.replace(/"/g, '').trim(), 
                        p: c[2]?.replace(/"/g, '').trim(), 
                        t: c[3]?.replace(/"/g, '').trim() 
                    };
                });
            } catch (e) { console.error("CSVè®€å–å¤±æ•—"); }
            render();
        }

        function render() {
            const
